{% extends 'master.html' %}
{% load static %}
{% block conteudo %}

    <div class="container text-center mt-2 p-4">
        <div class="row">
        
            <h1 class="display-5 font-weight-bold mb-3">Criar Hospede</h1>
        </div>
        <div class="d-flex justify-content-center align-items-center">
            <div class="container text-center formlogin w-50">
                <form class=" p-4 rounded bg-transparent" action="{% url 'cadastros:criar_hospede' %}" method="POST">
                    {% csrf_token %}
                    <div class="text-start form-group">
                        <label for="txtNome" class="form-label">Nome</label>
                        <input type="text" id="txtNome" name="txtNome" placeholder="Insira seu email">
                        <div id="divEmailError" class="error-message mt-2 fade-in" style="font-size:10px; color:rgb(0, 217, 29);"> . </div>
                    </div>  
                    <div class="text-start form-group">
                        <label for="txtCpf" class="form-label">CPF</label>
                        <input type="text" id="txtCpf" name="txtCpf" placeholder="Insira seu cpf">
                        <div id="divEmailError" class="error-message mt-2 fade-in" style="font-size:10px; color:rgb(0, 217, 29);"> . </div>
                    </div>  
                    <div class="text-start form-group">
                        <label for="txtTelefone" class="form-label">Telefone</label>
                        <input type="text" id="txtTelefone" name="txtTelefone" placeholder="Insira seu email">
                        <div id="divEmailError" class="error-message mt-2 fade-in" style="font-size:10px; color:rgb(0, 217, 29);"> . </div>
                    </div>  
                    <div class="text-start form-group">
                        <label for="txtEmpresa" class="form-label">Empresa</label>
                        <input type="text" id="txtEmpresa" name="txtEmpresa" placeholder="Insira seu email">
                        <div id="divEmailError" class="error-message mt-2 fade-in" style="font-size:10px; color:rgb(0, 217, 29);"> . </div>
                    </div>
                    <button type="submit" class="btn btn-primary w-100 gestorii-input shadow mt-2" >Entrar</button>
                </form>
            </div>
        </div>
        <br>
        <br>
        <br>
        <br>
        <br>
        <br>

        
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
        <script>
            $(document).ready(function() {
                $('#txtEmail').on('input', function() {
                    var email = $(this).val();
                    $('#divPerfil').addClass('hidden-group');
                    $('#divSenha').addClass('hidden-group');
                    $('#slcPerfil').empty();
                    $('#divEmailError').addClass('fade-in').removeClass('show');

                    if (email.length > 0) {
                        $.ajax({
                            url: "{% url 'autenticacao:get_perfis' %}",
                            data: {'email': email},
                            success: function(data) {
                                if (data.usuario_existe) {
                                    if (data.perfis.length > 0) {
                                        $('#slcPerfil').empty();
                                        data.perfis.forEach(function(perfil) {
                                            $('#slcPerfil').append(new Option(perfil.nome, perfil.id));
                                        });
                                        $('#divPerfil').removeClass('hidden-group');
                                        $('#divSenha').removeClass('hidden-group');
                                        $('#divEmailError').text('Email Disponível!').addClass('show').css('color','green');
                                    } else {
                                        toastr.error("Nenhum perfil encontrado para este e-mail.", "Erro");
                                    }
                                } else {
                                    $('#divEmailError').text('Email está indisponível').addClass('show').css('color','red');
                                }
                            }
                        });
                    }
                });

                $('#btnEsqueciSenha').click(function(event) {
                    event.preventDefault();
                    toastr.info('Se você esqueceu sua senha contate o administrador do sistema.');
                    window.location.href = "http://127.0.0.1:8000/novaSenha/";
                });
            });
        </script>
        
{% endblock %}    